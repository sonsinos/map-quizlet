<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>US State Quiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom animations and map styles */
        .state-path {
            fill: #e5e7eb; /* gray-200 */
            stroke: #ffffff;
            stroke-width: 1;
            stroke-linejoin: round;
            stroke-linecap: round;
            transition: fill 0.2s ease, stroke 0.2s ease;
            cursor: pointer;
            vector-effect: non-scaling-stroke; /* Keeps borders sharp on resize */
        }
        
        .state-path:hover {
            fill: #cbd5e1; /* gray-300 */
            stroke: #94a3b8;
            z-index: 10;
        }

        /* The state currently being guessed */
        .active-state {
            fill: #3b82f6 !important; /* blue-500 */
            stroke: #1d4ed8 !important; /* blue-700 */
            stroke-width: 2;
            filter: drop-shadow(0 0 4px rgba(59, 130, 246, 0.4));
            z-index: 20; /* Ensure active state is on top */
        }

        /* Correctly guessed state */
        .correct-state {
            fill: #22c55e !important; /* green-500 */
            stroke: #15803d !important; /* green-700 */
        }

        /* Incorrectly guessed state */
        .wrong-state {
            fill: #ef4444 !important; /* red-500 */
            stroke: #b91c1c !important; /* red-700 */
        }

        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }

        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        /* Custom scrollbar for the list */
        .state-list::-webkit-scrollbar {
            width: 8px;
        }
        .state-list::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        .state-list::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        .state-list::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* Label styles for map */
        .state-label {
            fill: white;
            font-size: 14px;
            font-weight: bold;
            text-anchor: middle;
            dominant-baseline: central;
            pointer-events: none;
            text-shadow: 0 1px 3px rgba(0,0,0,0.8);
            animation: fadeIn 0.3s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Zoom Controls */
        .zoom-btn {
            @apply bg-white text-slate-700 hover:bg-slate-100 border border-slate-300 rounded shadow-sm w-10 h-10 flex items-center justify-center font-bold text-xl select-none;
        }
        .zoom-btn:active {
            @apply bg-slate-200 transform scale-95;
        }

        /* History Toggle Chevron */
        .chevron {
            transition: transform 0.2s ease;
        }
        .expanded .chevron {
            transform: rotate(180deg);
        }
    </style>
</head>
<body class="bg-slate-50 font-sans text-slate-800 h-[100dvh] flex flex-col overflow-hidden select-none">

    <!-- Header / Scoreboard -->
    <header class="bg-white shadow-sm z-40 relative">
        <div class="max-w-6xl mx-auto flex justify-between items-center px-2 pt-7 pb-2 md:py-3 relative z-50 bg-white">
            <h1 class="text-lg md:text-2xl font-bold text-slate-700 shrink-0 mr-1">
                ðŸ‡ºðŸ‡¸<span class="hidden sm:inline"> Quiz</span>
            </h1>
            
            <!-- Scoreboard / Toggle Button -->
            <button id="score-toggle" onclick="toggleHistory()" class="flex items-center gap-1 md:gap-4 bg-slate-50 hover:bg-slate-100 border border-slate-200 rounded-lg px-2 py-1 md:px-4 md:py-2 transition-colors group flex-grow justify-center max-w-md mx-2">
                <div class="flex gap-3 md:gap-6 text-xs md:text-sm font-medium w-full justify-around">
                    <div class="flex flex-col items-center">
                        <span class="text-[10px] text-slate-400 uppercase tracking-wider hidden sm:inline">Correct</span>
                        <span class="text-[10px] text-slate-400 uppercase tracking-wider sm:hidden">âœ”</span>
                        <span id="score-correct" class="text-green-600 font-bold text-base md:text-lg leading-none">0</span>
                    </div>
                    <div class="flex flex-col items-center">
                        <span class="text-[10px] text-slate-400 uppercase tracking-wider hidden sm:inline">Faulty</span>
                        <span class="text-[10px] text-slate-400 uppercase tracking-wider sm:hidden">âœ˜</span>
                        <span id="score-wrong" class="text-red-600 font-bold text-base md:text-lg leading-none">0</span>
                    </div>
                    <div class="flex flex-col items-center">
                        <span class="text-[10px] text-slate-400 uppercase tracking-wider hidden sm:inline">To Go</span>
                        <span class="text-[10px] text-slate-400 uppercase tracking-wider sm:hidden">Left</span>
                        <span id="score-left" class="text-blue-600 font-bold text-base md:text-lg leading-none">50</span>
                    </div>
                </div>
                <!-- Chevron Icon -->
                <svg class="chevron w-3 h-3 md:w-4 md:h-4 text-slate-400 group-hover:text-slate-600 ml-1 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
            </button>
            
            <button onclick="resetGame()" class="text-xs md:text-sm text-slate-500 hover:text-slate-800 underline shrink-0 ml-1">Restart</button>
        </div>

        <!-- History Dropdown (Absolute Panel) -->
        <div id="history-panel" class="hidden absolute top-full left-0 w-full bg-slate-50/95 backdrop-blur-sm border-b shadow-lg z-40 max-h-[60vh] flex flex-col">
            <div class="p-2 border-b border-slate-200 font-bold text-xs uppercase text-slate-500 tracking-wider text-center shrink-0">
                Match History
            </div>
            <div id="list-completed" class="overflow-y-auto p-2 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-1">
                <!-- Completed items populated here -->
                <div class="text-center text-slate-400 italic text-sm py-4 col-span-full" id="history-placeholder">No states guessed yet</div>
            </div>
        </div>
    </header>

    <!-- Main Game Area -->
    <main class="flex-grow flex flex-col lg:flex-row gap-2 lg:gap-4 p-2 lg:p-4 w-full max-w-7xl mx-auto overflow-hidden relative z-0">
        
        <!-- Sidebar List (Left on Desktop, Bottom on Mobile) - ONLY REMAINING STATES -->
        <aside class="order-2 lg:order-1 w-full lg:w-64 bg-white rounded-xl shadow-sm border border-slate-200 flex flex-col h-48 lg:h-full shrink-0 overflow-hidden">
            <div class="p-2 bg-slate-50 border-b font-bold text-xs uppercase text-slate-500 tracking-wider text-center shrink-0">
                Select State
            </div>
            <div id="list-remaining" class="state-list overflow-y-auto flex-1 p-1 space-y-1 min-h-0">
                <!-- Remaining items -->
            </div>
        </aside>

        <!-- Map Container -->
        <div class="order-1 lg:order-2 flex-grow relative bg-white rounded-xl shadow-sm border border-slate-200 p-1 lg:p-4 flex items-center justify-center overflow-hidden touch-none" id="map-container">
            
            <!-- Feedback Overlay -->
            <div id="feedback-container" class="absolute top-4 left-1/2 transform -translate-x-1/2 bg-white/95 backdrop-blur shadow-lg rounded-xl px-6 py-3 hidden z-30 border border-slate-100 text-center pointer-events-none transition-all duration-300">
                <h2 id="feedback-title" class="text-lg font-bold"></h2>
                <p id="feedback-message" class="text-sm text-slate-600"></p>
            </div>

            <!-- Zoom Controls -->
            <div class="absolute bottom-4 right-4 flex flex-col gap-2 z-20">
                <button class="zoom-btn" onclick="zoomMap(1.5)" title="Zoom In">+</button>
                <button class="zoom-btn" onclick="resetZoom()" title="Reset View">âŸ²</button>
                <button class="zoom-btn" onclick="zoomMap(0.66)" title="Zoom Out">-</button>
            </div>

            <!-- SVG Map - Standard D3 Albers USA ViewBox -->
            <div class="w-full h-full relative overflow-hidden cursor-grab active:cursor-grabbing">
                <svg viewBox="0 0 960 600" id="us-map" class="w-full h-full drop-shadow-md">
                    <g id="map-content" class="transition-transform duration-200 ease-out will-change-transform">
                        <!-- Paths injected by JS -->
                    </g>
                </svg>
            </div>
        </div>

    </main>

    <!-- Controls -->
    <footer class="bg-white border-t p-3 pb-6 shrink-0 z-50">
        <div class="max-w-2xl mx-auto w-full">
            <div id="input-area" class="flex gap-2">
                <div class="relative flex-grow">
                    <!-- Autocomplete Dropdown -->
                    <div id="autocomplete-list" class="absolute bottom-full left-0 w-full bg-white border border-slate-200 rounded-lg shadow-lg max-h-48 overflow-y-auto hidden z-50 mb-2">
                        <!-- Items injected by JS -->
                    </div>
                    <input type="text" id="guess-input" 
                        placeholder="Type name here..." 
                        class="w-full p-3 border rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:outline-none text-lg"
                        autocomplete="off">
                </div>
                <button id="submit-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 md:px-6 py-3 rounded-lg font-bold shadow-sm transition-colors">
                    Check
                </button>
            </div>
            <div id="game-over-area" class="hidden text-center">
                <h2 class="text-2xl font-bold mb-2">Quiz Complete!</h2>
                <p id="final-score" class="mb-4 text-slate-600"></p>
                <button onclick="resetGame()" class="bg-slate-800 text-white px-6 py-2 rounded-lg hover:bg-slate-700 transition-colors">Play Again</button>
            </div>
        </div>
    </footer>

    <script type="module">
        // Import Data from external source
        import { statesData } from 'https://sonsinos.github.io/map-quizlet/states_data.js';

        // Game State Variables
        let remainingStates = [];
        let currentTarget = null;
        let scoreCorrect = 0;
        let scoreWrong = 0;
        let gameActive = false;
        let stateStatuses = {}; // Stores 'correct' or 'wrong' for uncovered states
        let feedbackTimeout;

        // DOM Elements
        const mapEl = document.getElementById('us-map');
        const mapGroup = document.getElementById('map-content');
        const mapContainer = document.getElementById('map-container');
        const inputEl = document.getElementById('guess-input');
        const submitBtn = document.getElementById('submit-btn');
        const feedbackContainer = document.getElementById('feedback-container');
        const feedbackTitle = document.getElementById('feedback-title');
        const feedbackMsg = document.getElementById('feedback-message');
        const scoreCorrectEl = document.getElementById('score-correct');
        const scoreWrongEl = document.getElementById('score-wrong');
        const scoreLeftEl = document.getElementById('score-left');
        const inputArea = document.getElementById('input-area');
        const gameOverArea = document.getElementById('game-over-area');
        const finalScoreEl = document.getElementById('final-score');
        const listRemaining = document.getElementById('list-remaining');
        const listCompleted = document.getElementById('list-completed');
        const autocompleteList = document.getElementById('autocomplete-list');
        const historyPanel = document.getElementById('history-panel');
        const scoreToggle = document.getElementById('score-toggle');
        const historyPlaceholder = document.getElementById('history-placeholder');

        // Zoom/Pan State
        let currentScale = 1;
        let currentTranslate = { x: 0, y: 0 };
        let isDragging = false;
        let startPos = { x: 0, y: 0 };

        // Initialize Map
        function initMap() {
            mapGroup.innerHTML = '';
            statesData.forEach(state => {
                const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                path.setAttribute("d", state.d);
                path.setAttribute("id", state.id);
                path.setAttribute("class", "state-path");
                path.setAttribute("data-name", state.name);
                mapGroup.appendChild(path);
            });
        }

        // --- History Toggle Logic ---
        function toggleHistory() {
            historyPanel.classList.toggle('hidden');
            scoreToggle.classList.toggle('expanded');
        }

        // --- Zoom & Pan Logic ---

        function updateTransform() {
            mapGroup.style.transform = `translate(${currentTranslate.x}px, ${currentTranslate.y}px) scale(${currentScale})`;
        }

        function zoomMap(factor) {
            const newScale = currentScale * factor;
            // Clamp scale between 0.5x and 8x
            if (newScale >= 0.5 && newScale <= 8) {
                currentScale = newScale;
                updateTransform();
            }
        }

        function resetZoom() {
            currentScale = 1;
            currentTranslate = { x: 0, y: 0 };
            updateTransform();
        }

        // Mouse Pan Events
        mapContainer.addEventListener('mousedown', (e) => {
            isDragging = true;
            startPos = { x: e.clientX - currentTranslate.x, y: e.clientY - currentTranslate.y };
            mapContainer.style.cursor = 'grabbing';
        });

        window.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            e.preventDefault();
            currentTranslate.x = e.clientX - startPos.x;
            currentTranslate.y = e.clientY - startPos.y;
            updateTransform();
        });

        window.addEventListener('mouseup', () => {
            isDragging = false;
            mapContainer.style.cursor = 'grab';
        });

        // Touch Pan Events (for Mobile)
        mapContainer.addEventListener('touchstart', (e) => {
            if (e.touches.length === 1) {
                isDragging = true;
                const touch = e.touches[0];
                startPos = { x: touch.clientX - currentTranslate.x, y: touch.clientY - currentTranslate.y };
            }
        }, { passive: false });

        window.addEventListener('touchmove', (e) => {
            if (!isDragging) return;
            if (e.cancelable) e.preventDefault(); 
            const touch = e.touches[0];
            currentTranslate.x = touch.clientX - startPos.x;
            currentTranslate.y = touch.clientY - startPos.y;
            updateTransform();
        }, { passive: false });

        window.addEventListener('touchend', () => {
            isDragging = false;
        });


        // --- Game Logic ---

        // Initialize Sidebar List
        function initList() {
            listRemaining.innerHTML = '';
            listCompleted.innerHTML = '';
            // Restore placeholder
            listCompleted.appendChild(historyPlaceholder);
            historyPlaceholder.classList.remove('hidden');
            
            // Sort copy of states alphabetically
            const sortedStates = [...statesData].sort((a, b) => a.name.localeCompare(b.name));
            
            sortedStates.forEach(state => {
                const btn = document.createElement('button');
                btn.id = `btn-${state.id}`;
                btn.textContent = state.name;
                btn.className = "w-full text-left px-4 py-2 hover:bg-slate-100 transition-colors border-b border-slate-100 last:border-0 text-slate-700 font-medium text-sm";
                btn.onclick = () => {
                    if (gameActive) checkAnswer(state.name);
                };
                listRemaining.appendChild(btn);
            });
        }

        // Move a state from Remaining to Completed list (in Header)
        function moveStateToCompleted(state, isCorrect) {
            // Hide placeholder if it's the first item
            if (!historyPlaceholder.classList.contains('hidden')) {
                historyPlaceholder.classList.add('hidden');
            }

            const btn = document.getElementById(`btn-${state.id}`);
            if (btn) {
                btn.remove();
            }

            // Create new item for history list
            const completedItem = document.createElement('div');
            
            let classes = "px-3 py-2 rounded border text-sm font-bold flex justify-between items-center";
            
            if (isCorrect) {
                classes += " bg-green-50 border-green-200 text-green-700";
                completedItem.innerHTML = `<span>${state.name}</span> <span class="text-xs uppercase">âœ“</span>`;
            } else {
                classes += " bg-red-50 border-red-200 text-red-700";
                completedItem.innerHTML = `<span>${state.name}</span> <span class="text-xs uppercase">âœ—</span>`;
            }
            completedItem.className = classes;

            // Insert alphabetically into completed list (excluding placeholder)
            const existingItems = Array.from(listCompleted.children).filter(el => el.id !== 'history-placeholder');
            const nextItem = existingItems.find(item => item.textContent.trim().split(' ')[0].localeCompare(state.name) > 0);
            
            if (nextItem) {
                listCompleted.insertBefore(completedItem, nextItem);
            } else {
                listCompleted.appendChild(completedItem);
            }
        }

        // Initialize Game
        function resetGame() {
            // Reset variables
            remainingStates = [...statesData]; 
            scoreCorrect = 0;
            scoreWrong = 0;
            gameActive = true;
            stateStatuses = {}; 
            
            // Reset UI
            updateScoreboard();
            inputArea.classList.remove('hidden');
            gameOverArea.classList.add('hidden');
            feedbackContainer.classList.add('hidden');
            historyPanel.classList.add('hidden');
            scoreToggle.classList.remove('expanded');
            inputEl.value = '';
            inputEl.focus();

            // Reset Map Colors
            document.querySelectorAll('.state-path').forEach(el => {
                el.classList.remove('active-state', 'correct-state', 'wrong-state');
            });

            // Remove all existing labels
            document.querySelectorAll('.state-label').forEach(el => el.remove());

            // Re-init lists
            initList();
            
            // Reset Zoom
            resetZoom();

            // Start first round
            nextRound();
        }

        function updateScoreboard() {
            scoreCorrectEl.textContent = scoreCorrect;
            scoreWrongEl.textContent = scoreWrong;
            scoreLeftEl.textContent = remainingStates.length;
        }

        function nextRound() {
            if (remainingStates.length === 0) {
                endGame();
                return;
            }

            // Pick random state
            const randomIndex = Math.floor(Math.random() * remainingStates.length);
            currentTarget = remainingStates[randomIndex];
            
            // Remove from remaining
            remainingStates.splice(randomIndex, 1);
            
            // Highlight map
            highlightState(currentTarget.id);
            updateScoreboard();
            
            inputEl.value = '';
            inputEl.focus();
            gameActive = true;
        }

        function highlightState(id) {
            // Remove active class from previous
            document.querySelectorAll('.active-state').forEach(el => {
                el.classList.remove('active-state');
            });

            const el = document.getElementById(id);
            if (el) {
                el.classList.add('active-state');
            }
        }

        function checkAnswer(manualGuess = null) {
            // Close autocomplete immediately when checking answer
            closeAutocomplete();

            if (!currentTarget || !gameActive) return;

            // Use manual click or input value
            const userGuess = manualGuess ? manualGuess.toLowerCase() : inputEl.value.trim().toLowerCase();
            
            // Validate: Ensure the guess is a valid state name from our list
            const isValidState = statesData.some(state => state.name.toLowerCase() === userGuess);
            
            if (!isValidState) {
                // Shake input to indicate invalid/incomplete name
                inputEl.classList.add('shake');
                setTimeout(() => inputEl.classList.remove('shake'), 500);
                return;
            }

            const correctName = currentTarget.name.toLowerCase();
            const stateEl = document.getElementById(currentTarget.id);

            // Prevent multi-clicks during timeout
            gameActive = false; 

            // Hide previous feedback immediately
            feedbackContainer.classList.add('hidden');
            if (feedbackTimeout) clearTimeout(feedbackTimeout);

            if (userGuess === correctName) {
                // Correct
                scoreCorrect++;
                stateStatuses[correctName] = 'correct'; 
                stateEl.classList.remove('active-state');
                stateEl.classList.add('correct-state');
                
                // Add label to map
                addLabelToMap(currentTarget);

                // Move state to Completed list
                moveStateToCompleted(currentTarget, true);

                showFeedback(true, currentTarget.name);
                setTimeout(nextRound, 1000); 
            } else {
                // Incorrect
                scoreWrong++;
                stateStatuses[correctName] = 'wrong';
                stateEl.classList.remove('active-state');
                stateEl.classList.add('wrong-state');
                
                // Add label to map
                addLabelToMap(currentTarget);

                // Move state to Completed list
                moveStateToCompleted(currentTarget, false);

                // Shake effect on input (visual feedback)
                if (!manualGuess) {
                    inputEl.classList.add('shake');
                    setTimeout(() => inputEl.classList.remove('shake'), 500);
                }

                showFeedback(false, currentTarget.name);
                setTimeout(nextRound, 2500); 
            }
        }

        function addLabelToMap(state) {
            const el = document.getElementById(state.id);
            if (!el) return;
            
            // Get bounding box to find center
            const bbox = el.getBBox();
            const centerX = bbox.x + bbox.width / 2;
            const centerY = bbox.y + bbox.height / 2;

            const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
            text.setAttribute("x", centerX);
            text.setAttribute("y", centerY);
            text.setAttribute("class", "state-label");
            text.textContent = state.id; // Use ID (Abbreviation) to save space
            
            mapGroup.appendChild(text); // Append to the zoomed group
        }

        function showFeedback(isCorrect, name) {
            feedbackContainer.classList.remove('hidden');
            
            // Clear any existing timeout
            if (feedbackTimeout) clearTimeout(feedbackTimeout);

            if (isCorrect) {
                feedbackContainer.classList.remove('border-red-200', 'bg-red-50');
                feedbackContainer.classList.add('border-green-200', 'bg-green-50');
                feedbackTitle.textContent = "Correct!";
                feedbackTitle.className = "text-lg font-bold text-green-700";
                feedbackMsg.textContent = `${name} is correct.`;
            } else {
                feedbackContainer.classList.remove('border-green-200', 'bg-green-50');
                feedbackContainer.classList.add('border-red-200', 'bg-red-50');
                feedbackTitle.textContent = "Wrong!";
                feedbackTitle.className = "text-lg font-bold text-red-700";
                feedbackMsg.textContent = `That was ${name}.`;
            }

            // Auto-hide after 3 seconds
            feedbackTimeout = setTimeout(() => {
                feedbackContainer.classList.add('hidden');
            }, 3000);
        }

        function endGame() {
            inputArea.classList.add('hidden');
            gameOverArea.classList.remove('hidden');
            finalScoreEl.textContent = `You got ${scoreCorrect} correct and ${scoreWrong} wrong.`;
            feedbackContainer.classList.add('hidden');
        }

        // Event Listeners
        submitBtn.addEventListener('click', () => checkAnswer());
        
        inputEl.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                const firstItem = autocompleteList.querySelector('div');
                const isListVisible = !autocompleteList.classList.contains('hidden');
                
                // Only select if list is visible, item exists, and it's NOT disabled
                if (isListVisible && firstItem && !firstItem.hasAttribute('data-disabled')) {
                    e.preventDefault();
                    const suggestion = firstItem.dataset.value;
                    
                    if (inputEl.value.trim().toLowerCase() === suggestion.toLowerCase()) {
                        checkAnswer();
                    } else {
                        inputEl.value = suggestion;
                        closeAutocomplete();
                    }
                } else {
                    checkAnswer();
                }
            }
        });

        // Autocomplete Logic
        inputEl.addEventListener('input', function() {
            const val = this.value;
            closeAutocomplete();
            if (!val) return;

            const matches = statesData.filter(state => state.name.toLowerCase().startsWith(val.toLowerCase()));
            
            matches.sort((a, b) => {
                const aStatus = stateStatuses[a.name.toLowerCase()];
                const bStatus = stateStatuses[b.name.toLowerCase()];
                
                if (!aStatus && bStatus) return -1;
                if (aStatus && !bStatus) return 1;
                return a.name.localeCompare(b.name);
            });

            if (matches.length > 0) {
                autocompleteList.classList.remove('hidden');
                matches.forEach(state => {
                    const div = document.createElement('div');
                    const status = stateStatuses[state.name.toLowerCase()];
                    
                    // Base styling
                    let classes = "px-4 py-2 border-b border-slate-50 last:border-0 flex justify-between items-center";
                    
                    const nameHtml = `<strong>${state.name.substr(0, val.length)}</strong>${state.name.substr(val.length)}`;

                    if (status) {
                        classes += " cursor-not-allowed opacity-75";
                        if (status === 'correct') {
                            classes += " bg-green-50 text-green-700";
                            div.innerHTML = `<span>${nameHtml}</span> <span class="text-xs font-bold uppercase ml-2">Correct</span>`;
                        } else {
                            classes += " bg-red-50 text-red-700";
                            div.innerHTML = `<span>${nameHtml}</span> <span class="text-xs font-bold uppercase ml-2">Wrong</span>`;
                        }
                        div.setAttribute('data-disabled', 'true');
                    } else {
                        classes += " hover:bg-slate-100 cursor-pointer text-slate-700";
                        div.innerHTML = `<span>${nameHtml}</span>`;
                        
                        div.addEventListener('click', function() {
                            inputEl.value = state.name;
                            closeAutocomplete();
                            inputEl.focus();
                        });
                    }
                    
                    div.className = classes;
                    div.dataset.value = state.name;
                    autocompleteList.appendChild(div);
                });
            }
        });

        function closeAutocomplete() {
            autocompleteList.innerHTML = '';
            autocompleteList.classList.add('hidden');
        }

        // Close autocomplete when clicking outside
        document.addEventListener('click', function(e) {
            if (e.target !== inputEl && e.target !== autocompleteList) {
                closeAutocomplete();
            }
        });

        // Make functions globally available for HTML onclick handlers
        window.resetGame = resetGame;
        window.zoomMap = zoomMap;
        window.resetZoom = resetZoom;
        window.toggleHistory = toggleHistory;

        // Initialize on load
        initMap();
        initList();
        resetGame();

    </script>
</body>
</html>
